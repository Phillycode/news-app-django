{% extends "base.html" %}
{% load static %}
{% block title %}Publisher Dashboard - YourNews{% endblock %}
{% block content %}
  <div class="row justify-content-center">
    <div class="col-md-12">
      <h2 class="mb-4">Publisher Dashboard - {{ publisher.name }}</h2>
      <!-- Summary Cards -->
      <div class="row mb-4">
        <div class="col-md-2">
          <div class="card bg-primary text-white">
            <div class="card-body">
              <h6 class="card-title">Total Articles</h6>
              <h3>{{ total_articles_count }}</h3>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="card bg-info text-white">
            <div class="card-body">
              <h6 class="card-title">Newsletters</h6>
              <h3>{{ total_newsletters_count }}</h3>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="card bg-warning text-white">
            <div class="card-body">
              <h6 class="card-title">Pending</h6>
              <h3>{{ total_pending_articles }}</h3>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="card bg-success text-white">
            <div class="card-body">
              <h6 class="card-title">Approved</h6>
              <h3>{{ total_approved_articles }}</h3>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="card bg-danger text-white">
            <div class="card-body">
              <h6 class="card-title">Rejected</h6>
              <h3>{{ total_rejected_articles }}</h3>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="card bg-secondary text-white">
            <div class="card-body">
              <h6 class="card-title">Subscribers</h6>
              <h3>{{ publisher_subscriber_count }}</h3>
            </div>
          </div>
        </div>
      </div>
      <!-- Team Overview -->
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="card border-primary">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">Team Overview</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-6">
                  <div class="text-center">
                    <h4 class="text-primary">{{ editors_count }}</h4>
                    <p class="mb-0">Editors</p>
                  </div>
                </div>
                <div class="col-6">
                  <div class="text-center">
                    <h4 class="text-info">{{ journalists_count }}</h4>
                    <p class="mb-0">Journalists</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card border-secondary">
            <div class="card-header bg-secondary text-white">
              <h5 class="mb-0">Publisher Details</h5>
            </div>
            <div class="card-body">
              <p>
                <strong>Name:</strong> {{ publisher.name }}
              </p>
              {% if publisher.description %}
                <p>
                  <strong>Description:</strong> {{ publisher.description|truncatewords:20 }}
                </p>
              {% endif %}
              <p>
                <strong>Owner:</strong> {{ publisher.user.get_full_name|default:publisher.user.username }}
              </p>
            </div>
          </div>
        </div>
      </div>
      <!-- Tabs for Editors and Journalists -->
      <ul class="nav nav-tabs" id="teamTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active"
                  id="editors-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#editors"
                  type="button"
                  role="tab"
                  aria-controls="editors"
                  aria-selected="true">Editors ({{ editors_count }})</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link"
                  id="journalists-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#journalists"
                  type="button"
                  role="tab"
                  aria-controls="journalists"
                  aria-selected="false">Journalists ({{ journalists_count }})</button>
        </li>
      </ul>
      <!-- Tab Content -->
      <div class="tab-content" id="teamTabsContent">
        <!-- Editors Tab -->
        <div class="tab-pane fade show active"
             id="editors"
             role="tabpanel"
             aria-labelledby="editors-tab">
          <div class="mt-3">
            {% if editors %}
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-primary">
                    <tr>
                      <th>Username</th>
                      <th>Email</th>
                      <th>Role</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for editor in editors %}
                      <tr>
                        <td>{{ editor.user.username }}</td>
                        <td>{{ editor.user.email }}</td>
                        <td>
                          <span class="badge bg-primary">Editor</span>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="alert alert-info">No editors are currently assigned to your publisher.</div>
            {% endif %}
          </div>
        </div>
        <!-- Journalists Tab -->
        <div class="tab-pane fade"
             id="journalists"
             role="tabpanel"
             aria-labelledby="journalists-tab">
          <div class="mt-3">
            {% if journalists %}
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-info">
                    <tr>
                      <th>Username</th>
                      <th>Email</th>
                      <th>Articles</th>
                      <th>Newsletters</th>
                      <th>Subscribers</th>
                      <th>Pending</th>
                      <th>Approved</th>
                      <th>Rejected</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for journalist in journalists %}
                      <tr>
                        <td>{{ journalist.user.username }}</td>
                        <td>{{ journalist.user.email }}</td>
                        <td>
                          <span class="badge bg-primary">{{ journalist.article_count }}</span>
                        </td>
                        <td>
                          <span class="badge bg-info">{{ journalist.newsletter_count }}</span>
                        </td>
                        <td>
                          <span class="badge bg-secondary">{{ journalist.subscriber_count }}</span>
                        </td>
                        <td>
                          <span class="badge bg-warning text-dark">{{ journalist.pending_article_count }}</span>
                        </td>
                        <td>
                          <span class="badge bg-success">{{ journalist.approved_article_count }}</span>
                        </td>
                        <td>
                          <span class="badge bg-danger">{{ journalist.rejected_article_count }}</span>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="alert alert-info">No journalists are currently assigned to your publisher.</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
