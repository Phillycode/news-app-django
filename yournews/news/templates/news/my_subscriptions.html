{% extends "base.html" %}
{% block title %}My Subscriptions - YourNews{% endblock %}
{% block content %}
  <div class="row justify-content-center">
    <div class="col-md-12">
      <h2 class="mb-4">My Subscriptions</h2>
      <!-- Summary Card -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card bg-primary text-white">
            <div class="card-body">
              <h5 class="card-title">Total Subscriptions</h5>
              <h2>{{ total_subscriptions }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-info text-white">
            <div class="card-body">
              <h5 class="card-title">Journalists</h5>
              <h2>{{ journalist_subscriptions.count }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-success text-white">
            <div class="card-body">
              <h5 class="card-title">Publishers</h5>
              <h2>{{ publisher_subscriptions.count }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-warning text-white">
            <div class="card-body">
              <h5 class="card-title">Recent Articles</h5>
              <h2>{{ recent_articles.count }}</h2>
            </div>
          </div>
        </div>
      </div>
      <!-- Action Buttons -->
      <div class="mb-3">
        <a href="{% url 'news:browse_journalists' %}"
           class="btn btn-primary me-2">Browse Journalists</a>
        <a href="{% url 'news:browse_publishers' %}" class="btn btn-success">Browse Publishers</a>
      </div>
      <!-- Subscriptions Tabs -->
      <ul class="nav nav-tabs" id="subscriptionTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active"
                  id="recent-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#recent"
                  type="button"
                  role="tab"
                  aria-controls="recent"
                  aria-selected="true">Recent Articles</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link"
                  id="journalists-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#journalists"
                  type="button"
                  role="tab"
                  aria-controls="journalists"
                  aria-selected="false">Journalists ({{ journalist_subscriptions.count }})</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link"
                  id="publishers-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#publishers"
                  type="button"
                  role="tab"
                  aria-controls="publishers"
                  aria-selected="false">Publishers ({{ publisher_subscriptions.count }})</button>
        </li>
      </ul>
      <!-- Tab Content -->
      <div class="tab-content" id="subscriptionTabsContent">
        <!-- Recent Articles Tab -->
        <div class="tab-pane fade show active"
             id="recent"
             role="tabpanel"
             aria-labelledby="recent-tab">
          <div class="mt-3">
            {% if recent_articles %}
              <div class="row">
                {% for article in recent_articles %}
                  <div class="col-md-6 mb-3">
                    <div class="card h-100">
                      <div class="card-body">
                        <h5 class="card-title">{{ article.title }}</h5>
                        <p class="card-text text-muted mb-2">
                          By {{ article.journalist.user.get_full_name|default:article.journalist.user.username }}
                          | {{ article.created_at|date:"M d, Y" }}
                          | {{ article.publisher.name }}
                        </p>
                        <p class="card-text">{{ article.content|truncatewords:20 }}</p>
                        <a href="{% url 'news:article_detail' article.pk %}"
                           class="btn btn-primary btn-sm">Read More</a>
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% else %}
              <div class="alert alert-info mt-3">
                No recent articles from your subscriptions. <a href="{% url 'news:browse_journalists' %}">Subscribe to journalists</a> or <a href="{% url 'news:browse_publishers' %}">publishers</a> to see their latest content here.
              </div>
            {% endif %}
          </div>
        </div>
        <!-- Journalists Tab -->
        <div class="tab-pane fade"
             id="journalists"
             role="tabpanel"
             aria-labelledby="journalists-tab">
          <div class="mt-3">
            {% if journalist_subscriptions %}
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-info">
                    <tr>
                      <th>Journalist</th>
                      <th>Publisher</th>
                      <th>Subscribed Since</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for subscription in journalist_subscriptions %}
                      <tr>
                        <td>{{ subscription.journalist.user.get_full_name|default:subscription.journalist.user.username }}</td>
                        <td>{{ subscription.journalist.publisher.name }}</td>
                        <td>{{ subscription.subscribed_at|date:"M d, Y" }}</td>
                        <td>
                          <a href="{% url 'news:unsubscribe_journalist' subscription.journalist.id %}"
                             class="btn btn-outline-danger btn-sm">Unsubscribe</a>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="alert alert-info">
                You're not subscribed to any journalists yet. <a href="{% url 'news:browse_journalists' %}">Browse journalists</a> to start following your favorites!
              </div>
            {% endif %}
          </div>
        </div>
        <!-- Publishers Tab -->
        <div class="tab-pane fade"
             id="publishers"
             role="tabpanel"
             aria-labelledby="publishers-tab">
          <div class="mt-3">
            {% if publisher_subscriptions %}
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-success">
                    <tr>
                      <th>Publisher</th>
                      <th>Description</th>
                      <th>Subscribed Since</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for subscription in publisher_subscriptions %}
                      <tr>
                        <td>{{ subscription.publisher.name }}</td>
                        <td>{{ subscription.publisher.description|default:"No description available"|truncatewords:10 }}</td>
                        <td>{{ subscription.subscribed_at|date:"M d, Y" }}</td>
                        <td>
                          <a href="{% url 'news:unsubscribe_publisher' subscription.publisher.id %}"
                             class="btn btn-outline-danger btn-sm">Unsubscribe</a>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="alert alert-info">
                You're not subscribed to any publishers yet. <a href="{% url 'news:browse_publishers' %}">Browse publishers</a> to start following your favorites!
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
