{% extends "base.html" %}
{% load static %}
{% block title %}Editor Dashboard - YourNews{% endblock %}
{% block content %}
  <div class="row justify-content-center">
    <div class="col-md-12">
      <h2 class="mb-4">Editor Dashboard - {{ publisher_name }}</h2>
      <!-- Summary Cards -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card bg-primary text-white">
            <div class="card-body">
              <h5 class="card-title">Total Articles</h5>
              <h2>{{ total_count }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-warning text-white">
            <div class="card-body">
              <h5 class="card-title">Pending Review</h5>
              <h2>{{ pending_count }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-success text-white">
            <div class="card-body">
              <h5 class="card-title">Approved</h5>
              <h2>{{ approved_count }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-danger text-white">
            <div class="card-body">
              <h5 class="card-title">Rejected</h5>
              <h2>{{ rejected_count }}</h2>
            </div>
          </div>
        </div>
      </div>
      <!-- Articles Tabs -->
      <ul class="nav nav-tabs" id="articleTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active"
                  id="pending-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#pending"
                  type="button"
                  role="tab"
                  aria-controls="pending"
                  aria-selected="true">Pending Review ({{ pending_count }})</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link"
                  id="approved-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#approved"
                  type="button"
                  role="tab"
                  aria-controls="approved"
                  aria-selected="false">Approved ({{ approved_count }})</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link"
                  id="rejected-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#rejected"
                  type="button"
                  role="tab"
                  aria-controls="rejected"
                  aria-selected="false">Rejected ({{ rejected_count }})</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link"
                  id="all-tab"
                  data-bs-toggle="tab"
                  data-bs-target="#all"
                  type="button"
                  role="tab"
                  aria-controls="all"
                  aria-selected="false">All Articles ({{ total_count }})</button>
        </li>
      </ul>
      <!-- Tab Content -->
      <div class="tab-content" id="articleTabsContent">
        <!-- Pending Articles Tab -->
        <div class="tab-pane fade show active"
             id="pending"
             role="tabpanel"
             aria-labelledby="pending-tab">
          <div class="mt-3">
            {% if pending_articles %}
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-warning">
                    <tr>
                      <th>Title</th>
                      <th>Journalist</th>
                      <th>Submitted</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for article in pending_articles %}
                      <tr>
                        <td>{{ article.title }}</td>
                        <td>{{ article.journalist.user.get_full_name|default:article.journalist.user.username }}</td>
                        <td>{{ article.created_at|date:"M d, Y H:i" }}</td>
                        <td>
                          <div class="btn-group" role="group">
                            <a href="{% url 'news:article_detail' article.pk %}"
                               class="btn btn-info btn-sm">View</a>
                            <a href="{% url 'news:update_article' article.pk %}"
                               class="btn btn-warning btn-sm">Edit</a>
                            <a href="#"
                               class="btn btn-success btn-sm"
                               data-bs-toggle="modal"
                               data-bs-target="#approveModal-{{ article.id }}">Approve</a>
                            <a href="#"
                               class="btn btn-danger btn-sm"
                               data-bs-toggle="modal"
                               data-bs-target="#rejectModal-{{ article.id }}">Reject</a>
                          </div>
                          <!-- Approve Modal -->
                          <div class="modal fade"
                               id="approveModal-{{ article.id }}"
                               tabindex="-1">
                            <div class="modal-dialog">
                              <div class="modal-content">
                                <form method="post"
                                      action="{% url 'news:approve_article' article.pk %}">
                                  {% csrf_token %}
                                  <div class="modal-header">
                                    <h5 class="modal-title">Approve Article</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                  </div>
                                  <div class="modal-body">
                                    <p>
                                      <i class="fas fa-check-circle me-2 text-success"></i>
                                      Are you sure you want to approve and publish <strong>"{{ article.title }}"</strong>?
                                    </p>
                                    <p class="text-muted small">
                                      This article will be made visible to all users and marked as published.
                                    </p>
                                    <div class="card">
                                      <div class="card-body">
                                        <h6 class="card-subtitle mb-2 text-muted">Article Details:</h6>
                                        <p class="card-text small">
                                          <strong>Author:</strong> {{ article.journalist.user.get_full_name|default:article.journalist.user.username }}<br>
                                          <strong>Submitted:</strong> {{ article.created_at|date:"M d, Y H:i" }}
                                        </p>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-success">Approve & Publish</button>
                                  </div>
                                </form>
                              </div>
                            </div>
                          </div>
                          <!-- Reject Modal -->
                          <div class="modal fade"
                               id="rejectModal-{{ article.id }}"
                               tabindex="-1">
                            <div class="modal-dialog">
                              <div class="modal-content">
                                <form method="post"
                                      action="{% url 'news:reject_article' article.pk %}">
                                  {% csrf_token %}
                                  <div class="modal-header">
                                    <h5 class="modal-title">Reject Article</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                  </div>
                                  <div class="modal-body">
                                    <p class="text-danger">
                                      <i class="fas fa-exclamation-triangle me-2"></i>
                                      Are you sure you want to reject <strong>"{{ article.title }}"</strong>?
                                    </p>
                                    <p class="text-muted small">
                                      This article will be marked as rejected and will not be published. The journalist will be notified.
                                    </p>
                                    <div class="card">
                                      <div class="card-body">
                                        <h6 class="card-subtitle mb-2 text-muted">Article Details:</h6>
                                        <p class="card-text small">
                                          <strong>Author:</strong> {{ article.journalist.user.get_full_name|default:article.journalist.user.username }}<br>
                                          <strong>Submitted:</strong> {{ article.created_at|date:"M d, Y H:i" }}
                                        </p>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-danger">Reject Article</button>
                                  </div>
                                </form>
                              </div>
                            </div>
                          </div>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="alert alert-info">No pending articles at the moment.</div>
            {% endif %}
          </div>
        </div>
        <!-- Approved Articles Tab -->
        <div class="tab-pane fade"
             id="approved"
             role="tabpanel"
             aria-labelledby="approved-tab">
          <div class="mt-3">
            {% if approved_articles %}
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-success">
                    <tr>
                      <th>Title</th>
                      <th>Journalist</th>
                      <th>Submitted</th>
                      <th>Published</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for article in approved_articles %}
                      <tr>
                        <td>{{ article.title }}</td>
                        <td>{{ article.journalist.user.get_full_name|default:article.journalist.user.username }}</td>
                        <td>{{ article.created_at|date:"M d, Y H:i" }}</td>
                        <td>{{ article.updated_at|date:"M d, Y H:i" }}</td>
                        <td>
                          <div class="btn-group" role="group">
                            <a href="{% url 'news:article_detail' article.pk %}"
                               class="btn btn-info btn-sm">View</a>
                            <a href="{% url 'news:update_article' article.pk %}"
                               class="btn btn-warning btn-sm">Edit</a>
                            <a href="#"
                               class="btn btn-outline-danger btn-sm"
                               data-bs-toggle="modal"
                               data-bs-target="#unpublishModal-{{ article.id }}">Unpublish</a>
                          </div>
                          <!-- Unpublish Modal -->
                          <div class="modal fade"
                               id="unpublishModal-{{ article.id }}"
                               tabindex="-1">
                            <div class="modal-dialog">
                              <div class="modal-content">
                                <form method="post"
                                      action="{% url 'news:reject_article' article.pk %}">
                                  {% csrf_token %}
                                  <div class="modal-header">
                                    <h5 class="modal-title">Unpublish Article</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                  </div>
                                  <div class="modal-body">
                                    <p class="text-warning">
                                      <i class="fas fa-exclamation-triangle me-2"></i>
                                      Are you sure you want to unpublish <strong>"{{ article.title }}"</strong>?
                                    </p>
                                    <p class="text-muted small">
                                      This article will be removed from public view and marked as rejected. Users will no longer be able to see it.
                                    </p>
                                    <div class="card">
                                      <div class="card-body">
                                        <h6 class="card-subtitle mb-2 text-muted">Article Details:</h6>
                                        <p class="card-text small">
                                          <strong>Author:</strong> {{ article.journalist.user.get_full_name|default:article.journalist.user.username }}<br>
                                          <strong>Published:</strong> {{ article.updated_at|date:"M d, Y H:i" }}
                                        </p>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-outline-danger">Unpublish Article</button>
                                  </div>
                                </form>
                              </div>
                            </div>
                          </div>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="alert alert-info">No approved articles yet.</div>
            {% endif %}
          </div>
        </div>
        <!-- Rejected Articles Tab -->
        <div class="tab-pane fade"
             id="rejected"
             role="tabpanel"
             aria-labelledby="rejected-tab">
          <div class="mt-3">
            {% if rejected_articles %}
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-danger">
                    <tr>
                      <th>Title</th>
                      <th>Journalist</th>
                      <th>Submitted</th>
                      <th>Rejected</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for article in rejected_articles %}
                      <tr>
                        <td>{{ article.title }}</td>
                        <td>{{ article.journalist.user.get_full_name|default:article.journalist.user.username }}</td>
                        <td>{{ article.created_at|date:"M d, Y H:i" }}</td>
                        <td>{{ article.updated_at|date:"M d, Y H:i" }}</td>
                        <td>
                          <div class="btn-group" role="group">
                            <a href="{% url 'news:article_detail' article.pk %}"
                               class="btn btn-info btn-sm">View</a>
                            <a href="{% url 'news:update_article' article.pk %}"
                               class="btn btn-warning btn-sm">Edit</a>
                            <a href="#"
                               class="btn btn-success btn-sm"
                               data-bs-toggle="modal"
                               data-bs-target="#approveRejectedModal-{{ article.id }}">Approve</a>
                            <a href="{% url 'news:delete_article' article.pk %}"
                               class="btn btn-danger btn-sm">Delete</a>
                          </div>
                          <!-- Approve Modal for Rejected Articles -->
                          <div class="modal fade"
                               id="approveRejectedModal-{{ article.id }}"
                               tabindex="-1">
                            <div class="modal-dialog">
                              <div class="modal-content">
                                <form method="post"
                                      action="{% url 'news:approve_article' article.pk %}">
                                  {% csrf_token %}
                                  <div class="modal-header">
                                    <h5 class="modal-title">Approve Previously Rejected Article</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                  </div>
                                  <div class="modal-body">
                                    <p>
                                      <i class="fas fa-redo me-2 text-success"></i>
                                      Are you sure you want to approve and publish <strong>"{{ article.title }}"</strong>?
                                    </p>
                                    <p class="text-muted small">
                                      This previously rejected article will be approved and made visible to all users.
                                    </p>
                                    <div class="card">
                                      <div class="card-body">
                                        <h6 class="card-subtitle mb-2 text-muted">Article Details:</h6>
                                        <p class="card-text small">
                                          <strong>Author:</strong> {{ article.journalist.user.get_full_name|default:article.journalist.user.username }}<br>
                                          <strong>Originally Submitted:</strong> {{ article.created_at|date:"M d, Y H:i" }}<br>
                                          <strong>Last Rejected:</strong> {{ article.updated_at|date:"M d, Y H:i" }}
                                        </p>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-success">Approve & Publish</button>
                                  </div>
                                </form>
                              </div>
                            </div>
                          </div>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="alert alert-info">No rejected articles.</div>
            {% endif %}
          </div>
        </div>
        <!-- All Articles Tab -->
        <div class="tab-pane fade"
             id="all"
             role="tabpanel"
             aria-labelledby="all-tab">
          <div class="mt-3">
            {% if articles %}
              <div class="table-responsive">
                <table class="table table-striped table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>Title</th>
                      <th>Journalist</th>
                      <th>Status</th>
                      <th>Submitted</th>
                      <th>Last Updated</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for article in articles %}
                      <tr>
                        <td>{{ article.title }}</td>
                        <td>{{ article.journalist.user.get_full_name|default:article.journalist.user.username }}</td>
                        <td>
                          <span class="badge {% if article.status == 'approved' %}bg-success {% elif article.status == 'rejected' %}bg-danger {% else %}bg-warning{% endif %}">
                            {{ article.status|capfirst }}
                          </span>
                        </td>
                        <td>{{ article.created_at|date:"M d, Y H:i" }}</td>
                        <td>{{ article.updated_at|date:"M d, Y H:i" }}</td>
                        <td>
                          <div class="btn-group" role="group">
                            <a href="{% url 'news:article_detail' article.pk %}"
                               class="btn btn-info btn-sm">View</a>
                            <a href="{% url 'news:update_article' article.pk %}"
                               class="btn btn-warning btn-sm">Edit</a>
                            {% if article.status == 'pending' %}
                              <a href="#"
                                 class="btn btn-success btn-sm"
                                 data-bs-toggle="modal"
                                 data-bs-target="#approveAllModal-{{ article.id }}">Approve</a>
                              <a href="#"
                                 class="btn btn-danger btn-sm"
                                 data-bs-toggle="modal"
                                 data-bs-target="#rejectAllModal-{{ article.id }}">Reject</a>
                            {% elif article.status == 'approved' %}
                              <a href="#"
                                 class="btn btn-outline-danger btn-sm"
                                 data-bs-toggle="modal"
                                 data-bs-target="#unpublishAllModal-{{ article.id }}">Unpublish</a>
                            {% elif article.status == 'rejected' %}
                              <a href="#"
                                 class="btn btn-success btn-sm"
                                 data-bs-toggle="modal"
                                 data-bs-target="#approveRejectedAllModal-{{ article.id }}">Approve</a>
                              <a href="{% url 'news:delete_article' article.pk %}"
                                 class="btn btn-danger btn-sm">Delete</a>
                            {% endif %}
                          </div>
                        </td>
                      </tr>
                      <!-- Modals for All Articles Tab -->
                      {% if article.status == 'pending' %}
                        <!-- Approve Modal for All Articles -->
                        <div class="modal fade"
                             id="approveAllModal-{{ article.id }}"
                             tabindex="-1">
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <form method="post"
                                    action="{% url 'news:approve_article' article.pk %}">
                                {% csrf_token %}
                                <div class="modal-header">
                                  <h5 class="modal-title">Approve Article</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                  <p>
                                    <i class="fas fa-check-circle me-2 text-success"></i>
                                    Are you sure you want to approve and publish <strong>"{{ article.title }}"</strong>?
                                  </p>
                                  <div class="card">
                                    <div class="card-body">
                                      <h6 class="card-subtitle mb-2 text-muted">Article Details:</h6>
                                      <p class="card-text small">
                                        <strong>Author:</strong> {{ article.journalist.user.get_full_name|default:article.journalist.user.username }}<br>
                                        <strong>Status:</strong> <span class="badge bg-warning">{{ article.status|capfirst }}</span>
                                      </p>
                                    </div>
                                  </div>
                                </div>
                                <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                  <button type="submit" class="btn btn-success">Approve & Publish</button>
                                </div>
                              </form>
                            </div>
                          </div>
                        </div>
                        <!-- Reject Modal for All Articles -->
                        <div class="modal fade"
                             id="rejectAllModal-{{ article.id }}"
                             tabindex="-1">
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <form method="post"
                                    action="{% url 'news:reject_article' article.pk %}">
                                {% csrf_token %}
                                <div class="modal-header">
                                  <h5 class="modal-title">Reject Article</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                  <p class="text-danger">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    Are you sure you want to reject <strong>"{{ article.title }}"</strong>?
                                  </p>
                                  <div class="card">
                                    <div class="card-body">
                                      <h6 class="card-subtitle mb-2 text-muted">Article Details:</h6>
                                      <p class="card-text small">
                                        <strong>Author:</strong> {{ article.journalist.user.get_full_name|default:article.journalist.user.username }}<br>
                                        <strong>Status:</strong> <span class="badge bg-warning">{{ article.status|capfirst }}</span>
                                      </p>
                                    </div>
                                  </div>
                                </div>
                                <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                  <button type="submit" class="btn btn-danger">Reject Article</button>
                                </div>
                              </form>
                            </div>
                          </div>
                        </div>
                      {% elif article.status == 'approved' %}
                        <!-- Unpublish Modal for All Articles -->
                        <div class="modal fade"
                             id="unpublishAllModal-{{ article.id }}"
                             tabindex="-1">
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <form method="post"
                                    action="{% url 'news:reject_article' article.pk %}">
                                {% csrf_token %}
                                <div class="modal-header">
                                  <h5 class="modal-title">Unpublish Article</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                  <p class="text-warning">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    Are you sure you want to unpublish <strong>"{{ article.title }}"</strong>?
                                  </p>
                                  <div class="card">
                                    <div class="card-body">
                                      <h6 class="card-subtitle mb-2 text-muted">Article Details:</h6>
                                      <p class="card-text small">
                                        <strong>Author:</strong> {{ article.journalist.user.get_full_name|default:article.journalist.user.username }}<br>
                                        <strong>Status:</strong> <span class="badge bg-success">{{ article.status|capfirst }}</span>
                                      </p>
                                    </div>
                                  </div>
                                </div>
                                <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                  <button type="submit" class="btn btn-outline-danger">Unpublish Article</button>
                                </div>
                              </form>
                            </div>
                          </div>
                        </div>
                      {% elif article.status == 'rejected' %}
                        <!-- Approve Rejected Modal for All Articles -->
                        <div class="modal fade"
                             id="approveRejectedAllModal-{{ article.id }}"
                             tabindex="-1">
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <form method="post"
                                    action="{% url 'news:approve_article' article.pk %}">
                                {% csrf_token %}
                                <div class="modal-header">
                                  <h5 class="modal-title">Approve Previously Rejected Article</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                  <p>
                                    <i class="fas fa-redo me-2 text-success"></i>
                                    Are you sure you want to approve and publish <strong>"{{ article.title }}"</strong>?
                                  </p>
                                  <div class="card">
                                    <div class="card-body">
                                      <h6 class="card-subtitle mb-2 text-muted">Article Details:</h6>
                                      <p class="card-text small">
                                        <strong>Author:</strong> {{ article.journalist.user.get_full_name|default:article.journalist.user.username }}<br>
                                        <strong>Status:</strong> <span class="badge bg-danger">{{ article.status|capfirst }}</span>
                                      </p>
                                    </div>
                                  </div>
                                </div>
                                <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                  <button type="submit" class="btn btn-success">Approve & Publish</button>
                                </div>
                              </form>
                            </div>
                          </div>
                        </div>
                      {% endif %}
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% else %}
              <div class="alert alert-info">No articles have been submitted to your publisher yet.</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
